## 交换机与集线器
* 交换机端口及指示灯
	- 端口指示灯
	- 电源指示灯
	- 交换端口 *连接PC设备*
	- Console接口 *交换机配置接口*
* 交换机硬件结构
	- FLASH *闪存*
	> 交换机操作系统(RGNOS), 配置文件(config.text)
	- RAM 随机存储器
	> 交换机当前运行的配置(running-config) 
	- ROM 只读存储器
	> Mini OS, BootStart
* 交换机实际上为一台没有输入输出, 能转发网络数据包的计算机
* 集线器(hub)
	- 集线器不能隔离冲突域 
## 冲突域与广播域
* 冲突域
	- 冲突(Collision): 在以太网中,当两个数据帧同时被发到物理传输介质上, 并完全或部分重叠时, 就发生了数据冲突. 当冲突发生时, 将导致数据损坏
	- 冲突域: 连接到同一个共享介质的设备共同形成了一个冲突域
	- 共享型以太网
	> - 采用了总线型的拓扑
	> - 共享通信链路的带宽
	> - 数据信号就会在信道内碰撞产生冲突
	- 解决上述问题:
	> CSMA/CD协议(载波侦察听多路访问/冲突检测)
	> 1. 侦听信道上是否有信号在传输, 如果有的话,表明信道处于忙的状态就继续侦听, 知道信道空闲为止
	> 2. 若没有真听到任何信号, 就传输数据
	>
* 以太网交换机的特点
	- 交换工作在数据链路层
	- 交换机的每一个端口都是一个独立的冲突域
	- 交换机一端口隔离冲突域形成交换型以太网
* 广播域
	- 路由器与VLAN可以隔离广播域
* 交换机实现数据转发
	- 每台交换机上都有提张MAC地址表, 记录每个端口与其对应的PC机MAC地址
* 交换机地址学习功能
	- PC**A** ping PC**C**
	- 交换机收到帧后先打开源地址, 就学到了PC**A**的MAC地址
	- 从A中所发出的数据帧, 不知目的站从哪口转发, 采用泛洪(flooding)
	- PC**C**收到就会给一个回应, 学到了PC**C**的对应端口及MAC地址
	- 其他端口连接的PC机收到数据帧, 知道不属于自己, 便丢弃
	- 所有的端口同PC**A**与PC**C**一样互相收发过数据, 便可建立完整MAC地址表

## MAC地址老化
- 默认老化时间: 300s(5m)
- 如某端口300s内未发送出帧, 交换机便将该MAC地址条目从地址表中删除
- 如果在老化被移除后发送, 还需重新泛洪
- 查看/修改MAC地址老化时间指令
	- display mac-address aging-time *查看mac地址老化时间*
	- mac-address aging-time 500 *修改mac地址老化时间*

## 地址解析协议ARP
- 每台PC机中都有一张ARP表, 记录着主机的IP地址与MAC地址的对应关系
- ARP地址解析协议: 它负责将IP地址解析为MAC地址
- ARP协议原理
	- PC**A**发送到PC**B**, PC**A**检查自己的ARP缓存表, 查看是否有PC**B**的IP地址与MAC地址的对应关系. 如果有, 则会将PC**B**的MAC地址作为目标MAC地址封装到数据帧中
	- 如果没有, A则会发送一个ARP请求信息, 请求PC**B**的IP地址, 对应的MAC地址是多少
	- 当交换机接受到此帧(此帧不含目的MAC地址, 有源地址)之后, 发现此数据帧为广播帧, 因此, 会将此数据帧从非接受的所有接口发送出去
	- PC**B**接收到此数据帧后, 校对IP地址是本机的, 并将PC**A**的IP地址和MAC地址的对应关系记录到自己的ARP缓存表中, 同时发送回ARP应答, 其中包括自己的MAC地址
	- PC**A**在收到这个回应的数据帧后, 在自己的ARP缓存表中记录PC**B**的IP地址和MAC地址的对应关系. 因此交换机已经学习到了PC**A**,**B**的MAC地址了
- ARP表也有老化时间, 根据系统或产品的不同为2分钟或5分钟

## MAC地址泛洪攻击实例
- MAC地址泛洪攻击
	- 攻击者利用交换机的学习机制不断发送大量的MAC地址, 整个MAC表达到存储上限时, 交换机只能广播后续数据帧(泛洪), 导致攻击者捕获数据帧
	- 攻击者伪造不同MAC地址的数据帧
- MAC地址泛洪攻击概述
	- 攻击端捕获其他PC发送数据帧
- 数据帧的传输
	- 直通: 交换机接收到帧头, 立刻检查目的地址并转发
	- 存储转发: 交换机接收完整帧后, 检测无误, 开始转发, 否则丢弃该帧
	- 自由转发: 交换机仅检测帧的前64bit, 无误则转发
